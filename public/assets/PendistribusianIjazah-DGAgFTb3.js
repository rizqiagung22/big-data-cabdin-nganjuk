import{_ as w,a as x,r as k}from"./DataTable.vue_vue_type_script_setup_true_lang-JQNF7XXJ.js";import{u as I,_ as j,g as F,a as $,d as C,b as D}from"./FilterPendistribusianIjazah.vue_vue_type_script_setup_true_lang-BnC2iUhL.js";import{r as z,a as A}from"./FileSaver.min-CLWXV6HW.js";import{d as S,r as p,l as f,c as G,b as s,e as i,w as h,F as V,i as B,t as _,u as d}from"./index-DisDyyuw.js";import"./axios.plugin-Cr9Ns81A.js";import"./global.service-WSUCU1y3.js";const U={class:"bg-white rounded-lg shadow overflow-hidden"},E={class:"text-gray-500"},N={class:"flex items-center space-x-2"},L={class:"text-gray-500 w-[80px] truncate w-[80px] truncate"},R={class:"flex gap-2"},q=["onClick"],H=["onClick"],J={class:"text-gray-400 hover:text-blue-500 transition-colors",title:"Upload"},K=["for"],M=["id","onChange"],aa=S({__name:"PendistribusianIjazah",setup(O){const u=I(),c=p([]),P=[{key:"lembaga",label:"Satuan Lembaga"},{key:"file",label:"File"}],t=p({currentPage:1,itemsPerPage:10,totalItems:0}),g=()=>{t.value={currentPage:1,itemsPerPage:10,totalItems:0}},o=async(l=!1)=>{try{l&&g();const e=await F({search:u.search,tahun_id:u.tahun,page:t.value.currentPage,size:t.value.itemsPerPage});c.value=[...e.data.data.data],t.value.totalItems=e.data.data.total}catch(e){console.log(e),c.value=[],g()}};f(()=>t.value.currentPage,async()=>{await o()}),f(()=>t.value.itemsPerPage,async(l,e)=>{l!==e&&(t.value.currentPage=1,await o())});const v=async(l,e)=>{try{await $(l.id,l.name_file)}catch(a){a.status==404?alert("Gagal mengunduh file. File tidak ditemukan."):alert("Gagal mengunduh file. Silakan coba lagi.")}},b=async(l,e)=>{try{await C(l.id),await o()}catch(a){a.status==404?alert("Gagal mengahapus file. File tidak ditemukan."):alert("Gagal mengahapus file. Silakan coba lagi.")}},y=async(l,e,a,r)=>{console.log("upload");try{const n=l.target;if(n.files&&n.files.length>0){const m=new FormData;m.append("report_file",n.files[0]),await D(e.id,m),await o()}}catch{alert("Gagal upload file")}finally{const n=document.getElementById(r);n&&(n.value="")}};return(l,e)=>(B(),G(V,null,[e[2]||(e[2]=s("div",{class:"mb-4"},[s("h1",{class:"text-2xl font-bold text-gray-800"},"Pendistribusian Ijazah")],-1)),i(j,{class:"mb-4",onSubmit:o}),s("div",U,[i(w,{class:"my-4 flex justify-end px-2",modelValue:t.value.itemsPerPage,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.itemsPerPage=a)},null,8,["modelValue"]),i(x,{columns:P,data:c.value,"total-items":t.value.totalItems,"items-per-page":t.value.itemsPerPage,currentPage:t.value.currentPage,"onUpdate:currentPage":e[1]||(e[1]=a=>t.value.currentPage=a)},{"cell(lembaga)":h(({item:a})=>[s("span",E,_(a.jenjang),1)]),"cell(file)":h(({item:a})=>[s("div",N,[s("span",L,_(a.name_file??""),1),s("div",R,[s("div",{onClick:r=>v(a,"pagu"),class:"text-gray-400 hover:text-green-500 transition-colors",title:"Download"},[i(d(z),{class:"h-5 w-5"})],8,q),s("div",{onClick:r=>b(a,"pagu"),class:"text-gray-400 hover:text-red-500 transition-colors",title:"Delete"},[i(d(k),{class:"h-5 w-5"})],8,H),s("div",J,[s("label",{for:`item${a.id}`},[i(d(A),{class:"h-5 w-5"})],8,K),s("input",{type:"file",class:"hidden",id:`item${a.id}`,onChange:r=>y(r,a,"item",`item${a.id}`)},null,40,M)])])])]),_:1},8,["data","total-items","items-per-page","currentPage"])])],64))}});export{aa as default};
