import{_ as w,a as x,r as k}from"./DataTable.vue_vue_type_script_setup_true_lang-DY7X4hUp.js";import{g as I,a as F,d as $,u as j}from"./pendistribusian-ijazah.service-DArjo8VP.js";import{u as C}from"./tahun.strore-VJK20NBN.js";import{_ as D}from"./FilterBpopp.vue_vue_type_script_setup_true_lang-CVw3jcYQ.js";import{u as S}from"./admin.bos.store-CpXNwLIh.js";import{r as z,a as A}from"./admin.bpopp.store-Cc77VqiR.js";import{d as B,r as p,l as f,c as G,b as s,e as n,w as h,F as V,i as U,t as _,u as d}from"./index-BQYtnNF3.js";import"./axios.plugin-BErkf-r6.js";import"./global.service-BlmddMAm.js";const E={class:"bg-white rounded-lg shadow overflow-hidden"},N={class:"text-gray-500"},L={class:"flex items-center space-x-2"},R={class:"text-gray-500 w-[80px] truncate w-[80px] truncate"},T={class:"flex gap-2"},q=["onClick"],H=["onClick"],J={class:"text-gray-400 hover:text-blue-500 transition-colors",title:"Upload"},K=["for"],M=["id","onChange"],la=B({__name:"PendistribusianIjazah",setup(O){C();const u=S(),c=p([]),v=[{key:"lembaga",label:"Satuan Lembaga"},{key:"file",label:"File"}],t=p({currentPage:1,itemsPerPage:10,totalItems:0}),m=()=>{t.value={currentPage:1,itemsPerPage:10,totalItems:0}},o=async(l=!1)=>{try{l&&m();const e=await I({search:u.search,tahun_id:u.tahun,page:t.value.currentPage,size:t.value.itemsPerPage});c.value=[...e.data.data.data],t.value.totalItems=e.data.data.total}catch(e){console.log(e),c.value=[],m()}};f(()=>t.value.currentPage,async()=>{await o()}),f(()=>t.value.itemsPerPage,async(l,e)=>{l!==e&&(t.value.currentPage=1,await o())});const P=async(l,e)=>{try{await F(l.id,l.name_file)}catch(a){a.status==404?alert("Gagal mengunduh file. File tidak ditemukan."):alert("Gagal mengunduh file. Silakan coba lagi.")}},y=async(l,e)=>{try{await $(l.id),await o()}catch(a){a.status==404?alert("Gagal mengahapus file. File tidak ditemukan."):alert("Gagal mengahapus file. Silakan coba lagi.")}},b=async(l,e,a,r)=>{console.log("upload");try{const i=l.target;if(i.files&&i.files.length>0){const g=new FormData;g.append("report_file",i.files[0]),await j(e.id,g),await o()}}catch{alert("Gagal upload file")}finally{const i=document.getElementById(r);i&&(i.value="")}};return(l,e)=>(U(),G(V,null,[e[2]||(e[2]=s("div",{class:"mb-4"},[s("h1",{class:"text-2xl font-bold text-gray-800"},"Pendistribusian Ijazah")],-1)),n(D,{class:"mb-4",onSubmit:o}),s("div",E,[n(w,{class:"my-4 flex justify-end px-2",modelValue:t.value.itemsPerPage,"onUpdate:modelValue":e[0]||(e[0]=a=>t.value.itemsPerPage=a)},null,8,["modelValue"]),n(x,{columns:v,data:c.value,"total-items":t.value.totalItems,"items-per-page":t.value.itemsPerPage,currentPage:t.value.currentPage,"onUpdate:currentPage":e[1]||(e[1]=a=>t.value.currentPage=a)},{"cell(lembaga)":h(({item:a})=>[s("span",N,_(a.jenjang),1)]),"cell(file)":h(({item:a})=>[s("div",L,[s("span",R,_(a.name_file??""),1),s("div",T,[s("div",{onClick:r=>P(a,"pagu"),class:"text-gray-400 hover:text-green-500 transition-colors",title:"Download"},[n(d(z),{class:"h-5 w-5"})],8,q),s("div",{onClick:r=>y(a,"pagu"),class:"text-gray-400 hover:text-red-500 transition-colors",title:"Delete"},[n(d(k),{class:"h-5 w-5"})],8,H),s("div",J,[s("label",{for:`item${a.id}`},[n(d(A),{class:"h-5 w-5"})],8,K),s("input",{type:"file",class:"hidden",id:`item${a.id}`,onChange:r=>b(r,a,"item",`item${a.id}`)},null,40,M)])])])]),_:1},8,["data","total-items","items-per-page","currentPage"])])],64))}});export{la as default};
