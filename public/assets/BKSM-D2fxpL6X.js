import{_ as x,a as k,r as b}from"./DataTable.vue_vue_type_script_setup_true_lang-DY7X4hUp.js";import{g as B,a as S,d as F,u as $}from"./bksm.service-BCqOFAx-.js";import{u as C}from"./tahun.strore-VJK20NBN.js";import{_ as D}from"./FilterBpopp.vue_vue_type_script_setup_true_lang-CVw3jcYQ.js";import{u as A}from"./admin.bos.store-CpXNwLIh.js";import{r as G,a as I}from"./admin.bpopp.store-Cc77VqiR.js";import{d as V,r as p,l as f,c as U,b as s,e as o,w as h,F as j,i as E,t as _,u as d}from"./index-BQYtnNF3.js";import"./axios.plugin-BErkf-r6.js";import"./global.service-BlmddMAm.js";const K={class:"bg-white rounded-lg shadow overflow-hidden"},M={class:"text-gray-500"},N={class:"flex items-center space-x-2"},z={class:"text-gray-500 w-[80px] truncate w-[80px] truncate"},L={class:"flex gap-2"},R=["onClick"],T=["onClick"],q={class:"text-gray-400 hover:text-blue-500 transition-colors",title:"Upload"},H=["for"],J=["id","onChange"],le=V({__name:"BKSM",setup(O){C();const u=A(),c=p([]),v=[{key:"lembaga",label:"Satuan Lembaga"},{key:"file",label:"File"}],t=p({currentPage:1,itemsPerPage:10,totalItems:0}),m=()=>{t.value={currentPage:1,itemsPerPage:10,totalItems:0}},i=async(l=!1)=>{try{l&&m();const a=await B({search:u.search,tahun_id:u.tahun,page:t.value.currentPage,size:t.value.itemsPerPage});c.value=[...a.data.data.data],t.value.totalItems=a.data.data.total}catch(a){console.log(a),c.value=[],m()}};f(()=>t.value.currentPage,async()=>{await i()}),f(()=>t.value.itemsPerPage,async(l,a)=>{l!==a&&(t.value.currentPage=1,await i())});const y=async(l,a)=>{try{await S(l.id,l.name_file)}catch(e){e.status==404?alert("Gagal mengunduh file. File tidak ditemukan."):alert("Gagal mengunduh file. Silakan coba lagi.")}},P=async(l,a)=>{try{await F(l.id),await i()}catch(e){e.status==404?alert("Gagal mengahapus file. File tidak ditemukan."):alert("Gagal mengahapus file. Silakan coba lagi.")}},w=async(l,a,e,r)=>{console.log("upload");try{const n=l.target;if(n.files&&n.files.length>0){const g=new FormData;g.append("report_file",n.files[0]),await $(a.id,g),await i()}}catch{alert("Gagal upload file")}finally{const n=document.getElementById(r);n&&(n.value="")}};return(l,a)=>(E(),U(j,null,[a[2]||(a[2]=s("div",{class:"mb-4"},[s("h1",{class:"text-2xl font-bold text-gray-800"},"BKSM"),s("p",{class:"text-gray-600"},"Bantuan Khusus Siswa Miskin")],-1)),o(D,{class:"mb-4",onSubmit:i}),s("div",K,[o(x,{class:"my-4 flex justify-end px-2",modelValue:t.value.itemsPerPage,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value.itemsPerPage=e)},null,8,["modelValue"]),o(k,{columns:v,data:c.value,"total-items":t.value.totalItems,"items-per-page":t.value.itemsPerPage,currentPage:t.value.currentPage,"onUpdate:currentPage":a[1]||(a[1]=e=>t.value.currentPage=e)},{"cell(lembaga)":h(({item:e})=>[s("span",M,_(e.jenjang),1)]),"cell(file)":h(({item:e})=>[s("div",N,[s("span",z,_(e.name_file??""),1),s("div",L,[s("div",{onClick:r=>y(e,"pagu"),class:"text-gray-400 hover:text-green-500 transition-colors",title:"Download"},[o(d(G),{class:"h-5 w-5"})],8,R),s("div",{onClick:r=>P(e,"pagu"),class:"text-gray-400 hover:text-red-500 transition-colors",title:"Delete"},[o(d(b),{class:"h-5 w-5"})],8,T),s("div",q,[s("label",{for:`item${e.id}`},[o(d(I),{class:"h-5 w-5"})],8,H),s("input",{type:"file",class:"hidden",id:`item${e.id}`,onChange:r=>w(r,e,"item",`item${e.id}`)},null,40,J)])])])]),_:1},8,["data","total-items","items-per-page","currentPage"])])],64))}});export{le as default};
