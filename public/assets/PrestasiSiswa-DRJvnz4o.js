import{_ as F,a as U,r as f}from"./DataTable.vue_vue_type_script_setup_true_lang-AtLWOcLb.js";import{u as A,_ as V,g as G,a as I,d as j,b as B}from"./FilterPrestasiSiswa.vue_vue_type_script_setup_true_lang-DeUvjyLf.js";import{u as E}from"./axios.plugin-CVK5CeTo.js";import{r as y,a as m}from"./FileSaver.min-CR4blg5B.js";import{d as N,r as $,l as D,c as r,b as a,e as n,w as h,F as z,i as c,t as _,j as u,u as t}from"./index-D0E--Iw5.js";import"./global.service-CsoV2rCN.js";const L={class:"bg-white rounded-lg shadow overflow-hidden"},R={class:"text-gray-500"},q={class:"flex items-center space-x-2"},H={class:"text-gray-500 w-[80px] truncate w-[80px] truncate"},J={class:"flex gap-2"},K=["onClick"],M=["onClick"],O={key:1,class:"text-gray-400 hover:text-blue-500 transition-colors",title:"Upload"},Q=["for"],T=["id","onChange"],W={class:"flex items-center space-x-2"},X={class:"text-gray-500 w-[80px] truncate w-[80px] truncate"},Y={class:"flex gap-2"},Z=["onClick"],ee=["onClick"],ae={key:1,class:"text-gray-400 hover:text-blue-500 transition-colors",title:"Upload"},te=["for"],se=["id","onChange"],ne={class:"flex items-center space-x-2"},oe={class:"text-gray-500 w-[80px] truncate w-[80px] truncate"},le={class:"flex gap-2"},ie=["onClick"],re=["onClick"],ce={key:1,class:"text-gray-400 hover:text-blue-500 transition-colors",title:"Upload"},de=["for"],ue=["id","onChange"],pe={class:"flex items-center space-x-2"},he={class:"text-gray-500 w-[80px] truncate w-[80px] truncate"},_e={class:"flex gap-2"},ge=["onClick"],ve=["onClick"],ke={key:1,class:"text-gray-400 hover:text-blue-500 transition-colors",title:"Upload"},xe=["for"],fe=["id","onChange"],ye={class:"flex items-center space-x-2"},me={class:"text-gray-500 w-[80px] truncate w-[80px] truncate"},we={class:"flex gap-2"},be=["onClick"],Ce=["onClick"],Pe={key:1,class:"text-gray-400 hover:text-blue-500 transition-colors",title:"Upload"},$e=["for"],De=["id","onChange"],je=N({__name:"PrestasiSiswa",setup(Se){const b=A(),d=E(),w=$([]),S=[{key:"lembaga",label:"Satuan Lembaga"},{key:"kecamatan",label:"kecamatan"},{key:"kabupaten",label:"kabupaten"},{key:"provinsi",label:"provinsi"},{key:"nasional",label:"nasional"},{key:"internasional",label:"internasional"}],l=$({currentPage:1,itemsPerPage:10,totalItems:0}),C=()=>{l.value={currentPage:1,itemsPerPage:10,totalItems:0}},g=async(i=!1)=>{try{i&&C();const o=await G({search:b.search,tahun_id:b.tahun,page:l.value.currentPage,size:l.value.itemsPerPage});w.value=[...o.data.data.data],l.value.totalItems=o.data.data.total}catch(o){console.log(o),w.value=[],C()}};D(()=>l.value.currentPage,async()=>{await g()}),D(()=>l.value.itemsPerPage,async(i,o)=>{i!==o&&(l.value.currentPage=1,await g())});const v=async(i,o)=>{try{await I(i.id,i.name_file)}catch(e){e.status==404?alert("Gagal mengunduh file. File tidak ditemukan."):alert("Gagal mengunduh file. Silakan coba lagi.")}},k=async(i,o)=>{try{await j(i.id),await g()}catch(e){e.status==404?alert("Gagal mengahapus file. File tidak ditemukan."):alert("Gagal mengahapus file. Silakan coba lagi.")}},x=async(i,o,e,s)=>{console.log("upload");try{const p=i.target;if(p.files&&p.files.length>0){const P=new FormData;P.append("report_file",p.files[0]),await B(o.id,P),await g()}}catch{alert("Gagal upload file")}finally{const p=document.getElementById(s);p&&(p.value="")}};return(i,o)=>(c(),r(z,null,[o[2]||(o[2]=a("div",{class:"mb-4"},[a("h1",{class:"text-2xl font-bold text-gray-800"},"Prestasi Siswa")],-1)),n(V,{class:"mb-4",onSubmit:g}),a("div",L,[n(F,{class:"my-4 flex justify-end px-2",modelValue:l.value.itemsPerPage,"onUpdate:modelValue":o[0]||(o[0]=e=>l.value.itemsPerPage=e)},null,8,["modelValue"]),n(U,{columns:S,data:w.value,"total-items":l.value.totalItems,"items-per-page":l.value.itemsPerPage,currentPage:l.value.currentPage,"onUpdate:currentPage":o[1]||(o[1]=e=>l.value.currentPage=e)},{"cell(lembaga)":h(({item:e})=>[a("span",R,_(e.jenjang),1)]),"cell(kecamatan)":h(({item:e})=>[a("div",q,[a("span",H,_(e.kecamatan.name_file??""),1),a("div",J,[a("div",{onClick:s=>v(e.kecamatan,"kecamatan"),class:"text-gray-400 hover:text-green-500 transition-colors",title:"Download"},[n(t(y),{class:"h-5 w-5"})],8,K),t(d).user.role!="user"?(c(),r("div",{key:0,onClick:s=>k(e.kecamatan,"kecamatan"),class:"text-gray-400 hover:text-red-500 transition-colors",title:"Delete"},[n(t(f),{class:"h-5 w-5"})],8,M)):u("",!0),t(d).user.role!="user"?(c(),r("div",O,[a("label",{for:`kecamatan${e.kecamatan.id}`},[n(t(m),{class:"h-5 w-5"})],8,Q),a("input",{type:"file",class:"hidden",id:`kecamatan${e.kecamatan.id}`,onChange:s=>x(s,e.kecamatan,"kecamatan",`kecamatan${e.kecamatan.id}`)},null,40,T)])):u("",!0)])])]),"cell(kabupaten)":h(({item:e})=>[a("div",W,[a("span",X,_(e.kabupaten.name_file??""),1),a("div",Y,[a("div",{onClick:s=>v(e.kabupaten,"kabupaten"),class:"text-gray-400 hover:text-green-500 transition-colors",title:"Download"},[n(t(y),{class:"h-5 w-5"})],8,Z),t(d).user.role!="user"?(c(),r("div",{key:0,onClick:s=>k(e.kabupaten,"kabupaten"),class:"text-gray-400 hover:text-red-500 transition-colors",title:"Delete"},[n(t(f),{class:"h-5 w-5"})],8,ee)):u("",!0),t(d).user.role!="user"?(c(),r("div",ae,[a("label",{for:`kabupaten${e.kabupaten.id}`},[n(t(m),{class:"h-5 w-5"})],8,te),a("input",{type:"file",class:"hidden",id:`kabupaten${e.kabupaten.id}`,onChange:s=>x(s,e.kabupaten,"kabupaten",`kabupaten${e.kabupaten.id}`)},null,40,se)])):u("",!0)])])]),"cell(provinsi)":h(({item:e})=>[a("div",ne,[a("span",oe,_(e.provinsi.name_file??""),1),a("div",le,[a("div",{onClick:s=>v(e.provinsi,"provinsi"),class:"text-gray-400 hover:text-green-500 transition-colors",title:"Download"},[n(t(y),{class:"h-5 w-5"})],8,ie),t(d).user.role!="user"?(c(),r("div",{key:0,onClick:s=>k(e.provinsi,"provinsi"),class:"text-gray-400 hover:text-red-500 transition-colors",title:"Delete"},[n(t(f),{class:"h-5 w-5"})],8,re)):u("",!0),t(d).user.role!="user"?(c(),r("div",ce,[a("label",{for:`provinsi${e.provinsi.id}`},[n(t(m),{class:"h-5 w-5"})],8,de),a("input",{type:"file",class:"hidden",id:`provinsi${e.provinsi.id}`,onChange:s=>x(s,e.provinsi,"provinsi",`provinsi${e.provinsi.id}`)},null,40,ue)])):u("",!0)])])]),"cell(nasional)":h(({item:e})=>[a("div",pe,[a("span",he,_(e.nasional.name_file??""),1),a("div",_e,[a("div",{onClick:s=>v(e.nasional,"nasional"),class:"text-gray-400 hover:text-green-500 transition-colors",title:"Download"},[n(t(y),{class:"h-5 w-5"})],8,ge),t(d).user.role!="user"?(c(),r("div",{key:0,onClick:s=>k(e.nasional,"nasional"),class:"text-gray-400 hover:text-red-500 transition-colors",title:"Delete"},[n(t(f),{class:"h-5 w-5"})],8,ve)):u("",!0),t(d).user.role!="user"?(c(),r("div",ke,[a("label",{for:`nasional${e.nasional.id}`},[n(t(m),{class:"h-5 w-5"})],8,xe),a("input",{type:"file",class:"hidden",id:`nasional${e.nasional.id}`,onChange:s=>x(s,e.nasional,"nasional",`nasional${e.nasional.id}`)},null,40,fe)])):u("",!0)])])]),"cell(internasional)":h(({item:e})=>[a("div",ye,[a("span",me,_(e.internasional.name_file??""),1),a("div",we,[a("div",{onClick:s=>v(e.internasional,"internasional"),class:"text-gray-400 hover:text-green-500 transition-colors",title:"Download"},[n(t(y),{class:"h-5 w-5"})],8,be),t(d).user.role!="user"?(c(),r("div",{key:0,onClick:s=>k(e.internasional,"internasional"),class:"text-gray-400 hover:text-red-500 transition-colors",title:"Delete"},[n(t(f),{class:"h-5 w-5"})],8,Ce)):u("",!0),t(d).user.role!="user"?(c(),r("div",Pe,[a("label",{for:`internasional${e.internasional.id}`},[n(t(m),{class:"h-5 w-5"})],8,$e),a("input",{type:"file",class:"hidden",id:`internasional${e.internasional.id}`,onChange:s=>x(s,e.internasional,"internasional",`internasional${e.internasional.id}`)},null,40,De)])):u("",!0)])])]),_:1},8,["data","total-items","items-per-page","currentPage"])])],64))}});export{je as default};
