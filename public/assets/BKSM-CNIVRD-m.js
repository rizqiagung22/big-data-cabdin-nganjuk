import{_ as S,a as C,r as F}from"./DataTable.vue_vue_type_script_setup_true_lang-JQNF7XXJ.js";import{g as $,a as D,d as A,u as V}from"./bksm.service-LskngX2f.js";import{u as G,_ as I}from"./FilterBksm.vue_vue_type_script_setup_true_lang-Dpl84hYE.js";import{u as j}from"./axios.plugin-Cr9Ns81A.js";import{r as U,a as E}from"./FileSaver.min-CLWXV6HW.js";import{d as K,r as _,l as v,c as m,b as l,e as o,w as y,F as M,i as g,t as P,j as w,u as c}from"./index-DisDyyuw.js";import"./global.service-WSUCU1y3.js";const N={class:"bg-white rounded-lg shadow overflow-hidden"},z={class:"text-gray-500"},L={class:"flex items-center space-x-2"},R={class:"text-gray-500 w-[80px] truncate w-[80px] truncate"},q={class:"flex gap-2"},H=["onClick"],J=["onClick"],O={key:1,class:"text-gray-400 hover:text-blue-500 transition-colors",title:"Upload"},Q=["for"],T=["id","onChange"],le=K({__name:"BKSM",setup(W){const u=G(),p=j(),d=_([]),k=[{key:"lembaga",label:"Satuan Lembaga"},{key:"file",label:"File"}],t=_({currentPage:1,itemsPerPage:10,totalItems:0}),f=()=>{t.value={currentPage:1,itemsPerPage:10,totalItems:0}},r=async(s=!1)=>{try{console.log(u.search,u.tahun),s&&f();const a=await $({search:u.search,tahun_id:u.tahun,page:t.value.currentPage,size:t.value.itemsPerPage});d.value=[...a.data.data.data],t.value.totalItems=a.data.data.total}catch(a){console.log(a),d.value=[],f()}};v(()=>t.value.currentPage,async()=>{await r()}),v(()=>t.value.itemsPerPage,async(s,a)=>{s!==a&&(t.value.currentPage=1,await r())});const x=async(s,a)=>{try{await D(s.id,s.name_file)}catch(e){e.status==404?alert("Gagal mengunduh file. File tidak ditemukan."):alert("Gagal mengunduh file. Silakan coba lagi.")}},b=async(s,a)=>{try{await A(s.id),await r()}catch(e){e.status==404?alert("Gagal mengahapus file. File tidak ditemukan."):alert("Gagal mengahapus file. Silakan coba lagi.")}},B=async(s,a,e,i)=>{console.log("upload");try{const n=s.target;if(n.files&&n.files.length>0){const h=new FormData;h.append("report_file",n.files[0]),await V(a.id,h),await r()}}catch{alert("Gagal upload file")}finally{const n=document.getElementById(i);n&&(n.value="")}};return(s,a)=>(g(),m(M,null,[a[2]||(a[2]=l("div",{class:"mb-4"},[l("h1",{class:"text-2xl font-bold text-gray-800"},"BKSM"),l("p",{class:"text-gray-600"},"Bantuan Khusus Siswa Miskin")],-1)),o(I,{class:"mb-4",onSubmit:r}),l("div",N,[o(S,{class:"my-4 flex justify-end px-2",modelValue:t.value.itemsPerPage,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value.itemsPerPage=e)},null,8,["modelValue"]),o(C,{columns:k,data:d.value,"total-items":t.value.totalItems,"items-per-page":t.value.itemsPerPage,currentPage:t.value.currentPage,"onUpdate:currentPage":a[1]||(a[1]=e=>t.value.currentPage=e)},{"cell(lembaga)":y(({item:e})=>[l("span",z,P(e.jenjang),1)]),"cell(file)":y(({item:e})=>[l("div",L,[l("span",R,P(e.name_file??""),1),l("div",q,[l("div",{onClick:i=>x(e,"pagu"),class:"text-gray-400 hover:text-green-500 transition-colors",title:"Download"},[o(c(U),{class:"h-5 w-5"})],8,H),c(p).user.role!="user"?(g(),m("div",{key:0,onClick:i=>b(e,"pagu"),class:"text-gray-400 hover:text-red-500 transition-colors",title:"Delete"},[o(c(F),{class:"h-5 w-5"})],8,J)):w("",!0),c(p).user.role!="user"?(g(),m("div",O,[l("label",{for:`item${e.id}`},[o(c(E),{class:"h-5 w-5"})],8,Q),l("input",{type:"file",class:"hidden",id:`item${e.id}`,onChange:i=>B(i,e,"item",`item${e.id}`)},null,40,T)])):w("",!0)])])]),_:1},8,["data","total-items","items-per-page","currentPage"])])],64))}});export{le as default};
